"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[24451,46832,90165],{63001:function(e,t,l){var i=l(46782),n=l(34789),a=l(79617),s=(l(69177),Object.create(HTMLSelectElement.prototype));function o(){return!(!n.A.edgeUwp&&!n.A.xboxOne&&(n.A.tizen||n.A.orsay||n.A.web0s||!n.A.tv&&i.A.tv))}function r(e){var t=c(e),l=t?t.textContent||t.innerText:null;a.default.show({items:e.options,positionTo:e,title:l}).then((function(t){!function(e,t){e.value=t}(e,t),function(e){var t=new Event("change",{bubbles:!1,cancelable:!0});e.dispatchEvent(t)}(e)}))}function c(e){for(var t=e.previousSibling;t&&"LABEL"!==t.tagName;)t=t.previousSibling;return t}function d(){var e=c(this);e&&e.classList.add("selectLabelFocused")}function u(){var e=c(this);e&&e.classList.remove("selectLabelFocused")}function v(e){e.button||o()||(e.preventDefault(),r(this))}function y(e){switch(e.keyCode){case 13:return void(o()||(e.preventDefault(),r(this)));case 37:case 38:case 39:case 40:return void(i.A.tv&&e.preventDefault())}}var f=0;s.createdCallback=function(){this.id||(this.id="embyselect"+f,f++),this.classList.add("emby-select-withcolor"),i.A.tv&&this.classList.add("emby-select-focusscale"),this.addEventListener("mousedown",v),this.addEventListener("keydown",y),this.addEventListener("focus",d),this.addEventListener("blur",u)},s.attachedCallback=function(){var e;if(!this.classList.contains("emby-select")){this.classList.add("emby-select");var t,l=this.ownerDocument.createElement("label");l.innerText=this.getAttribute("label")||"",l.classList.add("selectLabel"),l.htmlFor=this.id,null===(e=this.parentNode)||void 0===e||e.insertBefore(l,this),this.classList.contains("emby-select-withcolor")&&(null===(t=this.parentNode)||void 0===t||t.insertAdjacentHTML("beforeend",'<div class="selectArrowContainer"><div style="visibility:hidden;display:none;">0</div><span class="selectArrow material-icons keyboard_arrow_down" aria-hidden="true"></span></div>'))}},s.setLabel=function(e){var t;(null===(t=this.parentNode)||void 0===t?void 0:t.querySelector("label")).innerText=e},document.registerElement("emby-select",{prototype:s,extends:"select"})},79689:function(e,t,l){l.r(t),l.d(t,{PlaylistEditor:function(){return q}});var i,n=l(11444),a=l(77612),s=l(32215),o=l(4748),r=l(22696),c=l.n(r),d=l(50764),u=l(47629),v=l(5898),y=l(82885),f=l(66176),h=l(52993),p=l(79754),m=l(56869),b=l(46782),P=l(80669),A=l(38829),g=l(70267),S=l(86191),I=(l(10353),l(98959),l(15453),l(63001),function(){return I=Object.assign||function(e){for(var t,l=1,i=arguments.length;l<i;l++)for(var n in t=arguments[l])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},I.apply(this,arguments)});function w(e){var t,l=u.Ay.parentWithClass(this,"dialog");if(l){var n=null===(t=l.querySelector("#selectPlaylistToAddTo"))||void 0===t?void 0:t.value;m.Ay.show(),n?(y.currentSettings.set("playlisteditor-lastplaylistid",n),function(e,t){var l,n=S.A.getApiClient(i),a=(0,h.C)(n),s=(null===(l=e.querySelector(".fldSelectedItemIds"))||void 0===l?void 0:l.value)||"";return"queue"===t?(P.f.queue({serverId:i,ids:s.split(",")}),e.submitted=!0,p.default.close(e),Promise.resolve()):(0,o.C)(a).addItemToPlaylist({playlistId:t,ids:s.split(","),userId:n.getCurrentUserId()}).then((function(){e.submitted=!0,p.default.close(e)}))}(l,n).catch((function(e){console.error("[PlaylistEditor] Failed to add to playlist %s",n,e),(0,d.A)(v.Ay.translate("PlaylistError.AddFailed"))})).finally(m.Ay.hide)):function(e){var t,l,n,a=S.A.getApiClient(i),s=(0,h.C)(a),r=(null===(t=e.querySelector(".fldSelectedItemIds"))||void 0===t?void 0:t.value)||void 0;return(0,o.C)(s).createPlaylist({createPlaylistDto:{Name:null===(l=e.querySelector("#txtNewPlaylistName"))||void 0===l?void 0:l.value,IsPublic:null===(n=e.querySelector("#chkPlaylistPublic"))||void 0===n?void 0:n.checked,Ids:null==r?void 0:r.split(","),UserId:a.getCurrentUserId()}}).then((function(t){var l;e.submitted=!0,p.default.close(e),l=t.data.Id,g.appRouter.showItem(l,i)}))}(l).catch((function(e){console.error("[PlaylistEditor] Failed to create playlist",e),(0,d.A)(v.Ay.translate("PlaylistError.CreateFailed"))})).finally(m.Ay.hide)}else console.error("[PlaylistEditor] Dialog element is missing!");return e.preventDefault(),!1}function C(e){e.dispatchEvent(new CustomEvent("change",{}))}function L(e,t,i){e?Promise.resolve().then(l.bind(l,46345)).then((function(l){var n=i?"on":"off";l.centerFocus[n](e,t)})).catch((function(e){console.error("[PlaylistEditor] failed to load scroll helper",e)})):console.error("[PlaylistEditor] cannot focus null element")}var q=function(){function e(){}return e.prototype.show=function(e){var t,l=e.items||[];i=e.serverId;var r={removeOnClose:!0,scrollY:!1,size:b.A.tv?"fullscreen":"small"},d=p.default.createDialog(r);d.classList.add("formDialog");var u="",g=v.Ay.translate("HeaderAddToPlaylist");return u+='<div class="formDialogHeader">',u+='<button is="paper-icon-button-light" class="btnCancel autoSize" tabindex="-1" title="'.concat(v.Ay.translate("ButtonBack"),'"><span class="material-icons arrow_back" aria-hidden="true"></span></button>'),u+='<h3 class="formDialogHeaderTitle">',u+=g,u+="</h3>",u+="</div>",u+=function(e){var t="";t+='<div class="formDialogContent smoothScrollY" style="padding-top:2em;">',t+='<div class="dialogContentInner dialog-content-centered">',t+='<form style="margin:auto;">',t+='<div class="fldSelectPlaylist selectContainer">';var l=e.length?" autofocus":"";return t+='<select is="emby-select" id="selectPlaylistToAddTo" label="'.concat(v.Ay.translate("LabelPlaylist"),'"').concat(l,"></select>"),t+="</div>",t+='<div class="newPlaylistInfo">',t+='<div class="inputContainer">',l=e.length?"":" autofocus",t+='<input is="emby-input" type="text" id="txtNewPlaylistName" required="required" label="'.concat(v.Ay.translate("LabelName"),'"').concat(l," />"),t+="</div>",t+='\n    <div class="checkboxContainer checkboxContainer-withDescription">\n        <label>\n            <input type="checkbox" is="emby-checkbox" id="chkPlaylistPublic" checked />\n            <span>'.concat(v.Ay.translate("PlaylistPublic"),'</span>\n        </label>\n        <div class="fieldDescription checkboxFieldDescription">\n            ').concat(v.Ay.translate("PlaylistPublicDescription"),"\n        </div>\n    </div>"),t+="</div>",t+='<div class="formDialogFooter">',t+='<button is="emby-button" type="submit" class="raised btnSubmit block formDialogFooterItem button-submit">'.concat(v.Ay.translate("Add"),"</button>"),t+="</div>",t+='<input type="hidden" class="fldSelectedItemIds" />',t+="</form>",(t+="</div>")+"</div>"}(l),d.innerHTML=u,function(e,t,l){var r,d,u,p;null===(r=e.querySelector("#selectPlaylistToAddTo"))||void 0===r||r.addEventListener("change",(function(){var t,l,i,n;this.value?(null===(t=e.querySelector(".newPlaylistInfo"))||void 0===t||t.classList.add("hide"),null===(l=e.querySelector("#txtNewPlaylistName"))||void 0===l||l.removeAttribute("required")):(null===(i=e.querySelector(".newPlaylistInfo"))||void 0===i||i.classList.remove("hide"),null===(n=e.querySelector("#txtNewPlaylistName"))||void 0===n||n.setAttribute("required","required"))})),null===(d=e.querySelector("form"))||void 0===d||d.addEventListener("submit",w);var b=e.querySelector(".fldSelectedItemIds");if(b&&(b.value=l.join(",")),l.length)null===(u=e.querySelector(".fldSelectPlaylist"))||void 0===u||u.classList.remove("hide"),function(e,t){var l,r,d=t.querySelector("#selectPlaylistToAddTo");if(!d)return Promise.reject(new Error("Playlist <select> element is missing"));m.Ay.show(),null===(l=t.querySelector(".newPlaylistInfo"))||void 0===l||l.classList.add("hide");var u=S.A.getApiClient(i),p=(0,h.C)(u),b=null===(r=A.X.firstOfType(f.Q.SyncPlay))||void 0===r?void 0:r.instance;return(0,s.n)(p).getItems({userId:u.getCurrentUserId(),includeItemTypes:[n.D.Playlist],sortBy:[a.B.SortName],recursive:!0}).then((function(e){var t=e.data;return Promise.all((t.Items||[]).map((function(e){var t={item:e,permissions:void 0};return e.Id?(0,o.C)(p).getPlaylistUser({playlistId:e.Id,userId:u.getCurrentUserId()}).then((function(e){var l=e.data;return I(I({},t),{permissions:l})})).catch((function(e){return console.info("[PlaylistEditor] Failed to fetch playlist permissions",e),t})):t})))})).then((function(t){var l="";(!1!==e.enableAddToPlayQueue&&P.f.isPlaying()||(null==b?void 0:b.Manager.isSyncPlayEnabled()))&&(l+='<option value="queue">'.concat(v.Ay.translate("AddToPlayQueue"),"</option>")),l+='<option value="">'.concat(v.Ay.translate("OptionNew"),"</option>"),l+=t.map((function(e){var t=e.item,l=e.permissions;return(null==l?void 0:l.CanEdit)?'<option value="'.concat(t.Id,'">').concat(c()(t.Name),"</option>"):""})),d.innerHTML=l;var i=e.defaultValue;i||(i=y.currentSettings.get("playlisteditor-lastplaylistid")||""),d.value="new"===i?"":i,d.value||(d.value=""),C(d)}))}(t,e).catch((function(e){console.error("[PlaylistEditor] failed to populate playlists",e)})).finally(m.Ay.hide);else{null===(p=e.querySelector(".fldSelectPlaylist"))||void 0===p||p.classList.add("hide");var g=e.querySelector("#selectPlaylistToAddTo");g&&(g.innerHTML="",g.value="",C(g))}}(d,e,l),null===(t=d.querySelector(".btnCancel"))||void 0===t||t.addEventListener("click",(function(){p.default.close(d)})),b.A.tv&&L(d.querySelector(".formDialogContent"),!1,!0),p.default.open(d).then((function(){return b.A.tv&&L(d.querySelector(".formDialogContent"),!1,!1),d.submitted?Promise.resolve():Promise.reject(new Error)}))},e}();t.default=q}}]);