"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[90221],{1217:function(e,t,n){n.r(t),n.d(t,{default:function(){return y}}),n(44962),n(78557),n(90076),n(83994),n(82367);var r=n(8566),a=(n(14382),n(84734),n(86584),n(22696)),i=n.n(a),o=(n(96244),n(5898)),d=n(89100),l=n(83375);function s(e,t,n){var r=c(e),a={id:e.Id,text:r,state:{opened:e.IsFolder&&"open"==t,selected:n},li_attr:{serveritemtype:e.Type,collectiontype:e.CollectionType}};return e.IsFolder?(a.children=[{text:"Loading...",icon:!1}],a.icon=!1):a.icon=!1,a.state.opened&&(a.li_attr.loadedFromServer=!0),n&&(h=e.Id),a}function c(e){var t=e.Name;e.Number&&(t=e.Number+" - "+t),null!=e.IndexNumber&&"Season"!=e.Type&&(t=e.IndexNumber+" - "+t);var n="<div class='editorNode'>";return e.IsFolder?n+='<span class="material-icons metadataSidebarIcon folder" aria-hidden="true"></span>':"Video"===e.MediaType?n+='<span class="material-icons metadataSidebarIcon movie" aria-hidden="true"></span>':"Audio"===e.MediaType?n+='<span class="material-icons metadataSidebarIcon audiotrack" aria-hidden="true"></span>':"TvChannel"===e.Type?n+='<span class="material-icons metadataSidebarIcon live_tv" aria-hidden="true"></span>':"Photo"===e.MediaType?n+='<span class="material-icons metadataSidebarIcon photo" aria-hidden="true"></span>':"Book"===e.MediaType&&(n+='<span class="material-icons metadataSidebarIcon book" aria-hidden="true"></span>'),e.LockData&&(n+='<span class="material-icons metadataSidebarIcon lock" aria-hidden="true"></span>'),(n+=i()(t))+"</div>"}function u(e,t,r,a){Promise.all([Promise.all([n.e(87348),n.e(51850)]).then(n.t.bind(n,83392,23)),Promise.all([n.e(87348),n.e(73278)]).then(n.bind(n,871))]).then((function(){!function(e,t,n,r){g=[],h=null,$.jstree.destroy(),$(".libraryTree",e).jstree({plugins:["wholerow"],core:{check_callback:!0,data:function(e,t){!function(e,t,n,r,a,i,l){var c=n.id;if("#"!=c)if("livetv"!=c)if("MediaFolders"!=c){var u={ParentId:c,Fields:"Settings",IsVirtualUnaired:!1,IsMissing:!1,EnableTotalRecordCount:!1,EnableImages:!1,EnableUserData:!1},f=n.li_attr.itemtype;"Season"!=f&&"Series"!=f&&(u.SortBy="SortName"),ApiClient.getItems(d.default.getCurrentUserId(),u).then((function(e){var n=e.Items.map((function(e){return s(e,-1==r.indexOf(e.Id)?"closed":"open",e.Id==a)}));l.call(t,n);for(var i=0,o=n.length;i<o;i++)n[i].state.opened&&g.push(n[i].id)}))}else!function(e,t,n,r){ApiClient.getJSON(ApiClient.getUrl("Library/MediaFolders")).then((function(e){var a=e.Items.map((function(e){return s(e,-1==n.indexOf(e.Id)?"closed":"open",!1)}));r.call(t,a);for(var i=0,o=a.length;i<o;i++)a[i].state.opened&&g.push(a[i].id)}))}(0,t,r,l);else!function(e,t,n){ApiClient.getLiveTvChannels({ServiceName:e,AddCurrentProgram:!1}).then((function(e){var r=e.Items.map((function(e){return s(e,-1==t.indexOf(e.Id)?"closed":"open",!1)}));n(r)}))}(c,r,l);else!function(e,t,n){ApiClient.getLiveTvChannels({limit:0}).then((function(e){var r=[];r.push({id:"MediaFolders",text:o.Ay.translate("HeaderMediaFolders"),state:{opened:!0},li_attr:{itemtype:"mediafolders",loadedFromServer:!0},icon:!1}),e.TotalRecordCount&&r.push({id:"livetv",text:o.Ay.translate("LiveTV"),state:{opened:!1},li_attr:{itemtype:"livetv"},children:[{text:"Loading...",icon:!1}],icon:!1}),n.call(t,r),g.push("MediaFolders")}))}(0,t,l)}(0,this,e,n,r,0,t)},themes:{variant:"large"}}}).off("select_node.jstree",f).on("select_node.jstree",f).off("open_node.jstree",m).on("open_node.jstree",m).off("load_node.jstree",m).on("load_node.jstree",m)}(e,0,r,a)}))}function f(e,t){var n=t.node,r={id:n.id,itemType:n.li_attr.itemtype,serverItemType:n.li_attr.serveritemtype,collectionType:n.li_attr.collectiontype};"livetv"!=r.itemType&&"mediafolders"!=r.itemType?(this.dispatchEvent(new CustomEvent("itemclicked",{detail:r,bubbles:!0,cancelable:!1})),document.querySelector(".editPageSidebar").classList.add("editPageSidebar-withcontent")):document.querySelector(".editPageSidebar").classList.remove("editPageSidebar-withcontent")}function m(e,t){var n=$(this).parents(".page")[0],r=t.node;r.children&&function(e,t){for(var n=t.children,r=function(){var t=n[a];-1!=g.indexOf(t)&&(g=g.filter((function(e){return e!=t})),$.jstree.reference(".libraryTree",e).load_node(t,p))},a=0,i=n.length;a<i;a++)r()}(n,r),r.li_attr&&"#"!=r.id&&!r.li_attr.loadedFromServer&&(r.li_attr.loadedFromServer=!0,$.jstree.reference(".libraryTree",n).load_node(r.id,p))}function p(e){h&&e.children&&-1!=e.children.indexOf(h)&&setTimeout((function(){var e;(e=$("#"+h)[0])&&e.scrollIntoView()}),500)}function v(){return I||(0,l.E)("id")}var h,I,g=[];function b(e,t){r.Ay.show(),t?Promise.all([n.e(45642),n.e(26855),n.e(59845)]).then(n.bind(n,26855)).then((function(n){n.default.embed(e.querySelector(".editPageInnerContent"),t,ApiClient.serverInfo().Id)})):(e.querySelector(".editPageInnerContent").innerHTML="",r.Ay.hide())}function y(e){e.addEventListener("viewshow",(function(){b(this,MetadataEditor.getCurrentItemId())})),MetadataEditor.setCurrentItemId(null),e.querySelector(".libraryTree").addEventListener("itemclicked",(function(t){var n=t.detail;n.id!=MetadataEditor.getCurrentItemId()&&(MetadataEditor.setCurrentItemId(n.id),b(e,n.id))}))}$(document).on("itemsaved",".metadataEditorPage",(function(e,t){!function(e,t){var n=$("#"+t.Id+">a",e)[0];if(null!=n&&($(".editorNode",n).remove(),$(n).append(c(t)),t.IsFolder)){var r=jQuery.jstree._reference(".libraryTree"),a=r._get_node(null,!1);r.refresh(a)}}(this,t)})).on("pagebeforeshow",".metadataEditorPage",(function(){n.e(77268).then(n.bind(n,77268))})).on("pagebeforeshow",".metadataEditorPage",(function(){var e=this;d.default.getCurrentUser().then((function(t){var n=v();n?ApiClient.getAncestorItems(n,t.Id).then((function(t){var r=t.map((function(e){return e.Id}));u(e,0,r,n)})):u(e,0,[])}))})).on("pagebeforehide",".metadataEditorPage",(function(){$(".libraryTree",this).off("select_node.jstree",f).off("open_node.jstree",m).off("load_node.jstree",m)})),window.MetadataEditor={getItemPromise:function(){var e=v();return e?ApiClient.getItem(d.default.getCurrentUserId(),e):ApiClient.getRootFolder(d.default.getCurrentUserId())},getCurrentItemId:v,setCurrentItemId:function(e){I=e}}}}]);