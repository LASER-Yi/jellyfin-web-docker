"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[43381],{81524:function(t,e,a){a.r(e),a.d(e,{default:function(){return b}}),a(29305),a(32733),a(84701),a(69892),a(44962),a(89336),a(26448),a(9698),a(78557),a(95021),a(73687),a(83994),a(82367),a(96244);var n=a(8566),s=a(5898),i=a(10736),r=a(80096),l=a(28132),o=a(93721),d=a(44797),c=(a(10353),a(47629));function u(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(t){if("string"==typeof t)return f(t,e);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?f(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,l=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return r=t.done,t},e:function(t){l=!0,i=t},f:function(){try{r||null==a.return||a.return()}finally{if(l)throw i}}}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=Array(e);a<e;a++)n[a]=t[a];return n}function p(t){ApiClient.getScheduledTasks({isHidden:!1}).then((function(e){!function(t,e){var a,n,i="",r=u(e=e.sort((function(t,e){return(t=t.Category+" "+t.Name)>(e=e.Category+" "+e.Name)?1:t<e?-1:0})));try{for(r.s();!(n=r.n()).done;){var l=n.value;l.Category!=a&&((a=l.Category)&&(i+="</div>",i+="</div>"),i+='<div class="verticalSection verticalSection-extrabottompadding">',i+='<div class="sectionTitleContainer" style="margin-bottom:1em;">',i+='<h2 class="sectionTitle">',i+=a,i+="</h2>",i+="</div>",i+='<div class="paperList">'),i+='<div class="listItem listItem-border scheduledTaskPaperIconItem" data-status="'+l.State+'">',i+="<a is='emby-linkbutton' style='margin:0;padding:0;' class='clearLink listItemIconContainer' href='/dashboard/tasks/edit?id="+l.Id+"'>",i+='<span class="material-icons listItemIcon schedule" aria-hidden="true"></span>',i+="</a>",i+='<div class="listItemBody two-line">',i+="<a class='clearLink' style='margin:0;padding:0;display:block;text-align:"+(s.Ay.getIsRTL()?"right":"left")+";' is='emby-linkbutton' href='/dashboard/tasks/edit?id="+l.Id+"'>",i+="<h3 class='listItemBodyText'>"+l.Name+"</h3>",i+="<div class='secondary listItemBodyText' id='taskProgress"+l.Id+"'>"+y(l)+"</div>",i+="</a>",i+="</div>","Running"===l.State?i+='<button type="button" is="paper-icon-button-light" id="btnTask'+l.Id+'" class="btnStopTask" data-taskid="'+l.Id+'" title="'+s.Ay.translate("ButtonStop")+'"><span class="material-icons stop" aria-hidden="true"></span></button>':"Idle"===l.State&&(i+='<button type="button" is="paper-icon-button-light" id="btnTask'+l.Id+'" class="btnStartTask" data-taskid="'+l.Id+'" title="'+s.Ay.translate("ButtonStart")+'"><span class="material-icons play_arrow" aria-hidden="true"></span></button>'),i+="</div>"}}catch(t){r.e(t)}finally{r.f()}e.length&&(i+="</div>",i+="</div>"),t.querySelector(".divScheduledTasks").innerHTML=i}(t,e),n.Ay.hide()}))}function y(t){var e="";if("Idle"===t.State){if(t.LastExecutionResult){var a=Date.parse(t.LastExecutionResult.EndTimeUtc),n=Date.parse(t.LastExecutionResult.StartTimeUtc);e+=s.Ay.translate("LabelScheduledTaskLastRan",(0,r.A)(a,(0,o.OE)()),(0,l.A)(n,a,{locale:(0,o.JK)()})),"Failed"===t.LastExecutionResult.Status?e+=" <span style='color:#FF0000;'>("+s.Ay.translate("LabelFailed")+")</span>":"Cancelled"===t.LastExecutionResult.Status?e+=" <span style='color:#0026FF;'>("+s.Ay.translate("LabelCancelled")+")</span>":"Aborted"===t.LastExecutionResult.Status&&(e+=" <span style='color:#FF0000;'>"+s.Ay.translate("LabelAbortedByServerShutdown")+"</span>")}}else if("Running"===t.State){var i=(t.CurrentProgressPercentage||0).toFixed(1);e+='<div style="display:flex;align-items:center;">',e+='<div class="taskProgressOuter" title="'+i+'%" style="flex-grow:1;">',e+='<div class="taskProgressInner" style="width:'+i+'%;">',e+="</div>",e+="</div>",e+="<span style='color:#00a4dc;margin-left:5px;'>"+i+"%</span>",e+="</div>"}else e+="<span style='color:#FF0000;'>"+s.Ay.translate("LabelStopping")+"</span>";return e}function v(t,e){var a=t.querySelector(".material-icons");a.classList.remove("stop","play_arrow"),a.classList.add(e)}function h(t,e){"Running"===e?(t.classList.remove("btnStartTask"),t.classList.add("btnStopTask"),v(t,"stop"),t.title=s.Ay.translate("ButtonStop")):"Idle"===e&&(t.classList.add("btnStartTask"),t.classList.remove("btnStopTask"),v(t,"play_arrow"),t.title=s.Ay.translate("ButtonStart")),c.Ay.parentWithClass(t,"listItem").setAttribute("data-status",e)}function b(t){function e(){ApiClient.isMessageChannelOpen()||p(t)}function a(e,a,n){a.serverId()===r&&function(e){var a,n=u(e);try{for(n.s();!(a=n.n()).done;){var s=a.value,i=t.querySelector("#taskProgress".concat(s.Id));i&&(i.innerHTML=y(s));var r=t.querySelector("#btnTask".concat(s.Id));r&&h(r,s.State)}}catch(t){n.e(t)}finally{n.f()}}(n)}var s,r=ApiClient.serverId();$(".divScheduledTasks",t).on("click",".btnStartTask",(function(){var e=this,a=e.getAttribute("data-taskid");ApiClient.startScheduledTask(a).then((function(){h(e,"Running"),p(t)}))})),$(".divScheduledTasks",t).on("click",".btnStopTask",(function(){var e=this,a=e.getAttribute("data-taskid");ApiClient.stopScheduledTask(a).then((function(){h(e,""),p(t)}))})),t.addEventListener("viewbeforehide",(function(){d.A.off(i.default,"ScheduledTasksInfo",a),ApiClient.sendMessage("ScheduledTasksInfoStop"),s&&clearInterval(s)})),t.addEventListener("viewshow",(function(){n.Ay.show(),ApiClient.sendMessage("ScheduledTasksInfoStart","1000,1000"),s&&clearInterval(s),s=setInterval(e,1e4),p(t),d.A.on(i.default,"ScheduledTasksInfo",a)}))}}}]);