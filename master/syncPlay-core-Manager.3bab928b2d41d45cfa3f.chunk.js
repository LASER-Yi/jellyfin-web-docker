"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[41573],{60096:function(e,t,a){a.r(t),a(96626),a(26031),a(95822),a(56187),a(38690),a(81414),a(11908),a(33096),a(89228),a(13227),a(14011),a(11431);var n=a(7125);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function r(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:String(t)}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manager=null}var t,a;return t=e,a=[{key:"init",value:function(e){this.manager=e}},{key:"playPause",value:function(){this.manager.isPlaying()?this.pause():this.unpause()}},{key:"unpause",value:function(){this.manager.getApiClient().requestSyncPlayUnpause()}},{key:"pause",value:function(){this.manager.getApiClient().requestSyncPlayPause(),this.manager.getPlayerWrapper().localPause()}},{key:"seek",value:function(e){this.manager.getApiClient().requestSyncPlaySeek({PositionTicks:e})}},{key:"play",value:function(e){var t=this.manager.getApiClient(),a=function(a){var n=a.map((function(e){return e.Id}));return t.requestSyncPlaySetNewQueue({PlayingQueue:n,PlayingItemPosition:e.startIndex?e.startIndex:0,StartPositionTicks:e.startPositionTicks?e.startPositionTicks:0})};return e.items?n.translateItemsForPlayback(t,e.items,e).then(a):n.getItemsForPlayback(t,{Ids:e.ids.join(",")}).then((function(i){return n.translateItemsForPlayback(t,i.Items,e).then(a)}))}},{key:"setCurrentPlaylistItem",value:function(e){this.manager.getApiClient().requestSyncPlaySetPlaylistItem({PlaylistItemId:e})}},{key:"clearPlaylist",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.manager.getApiClient().requestSyncPlayRemoveFromPlaylist({ClearPlaylist:!0,ClearPlayingItem:e})}},{key:"removeFromPlaylist",value:function(e){this.manager.getApiClient().requestSyncPlayRemoveFromPlaylist({PlaylistItemIds:e})}},{key:"movePlaylistItem",value:function(e,t){this.manager.getApiClient().requestSyncPlayMovePlaylistItem({PlaylistItemId:e,NewIndex:t})}},{key:"queue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Queue",a=this.manager.getApiClient();e.items?n.translateItemsForPlayback(a,e.items,e).then((function(e){var n=e.map((function(e){return e.Id}));a.requestSyncPlayQueue({ItemIds:n,Mode:t})})):n.getItemsForPlayback(a,{Ids:e.ids.join(",")}).then((function(i){n.translateItemsForPlayback(a,i.Items,e).then((function(e){var n=e.map((function(e){return e.Id}));a.requestSyncPlayQueue({ItemIds:n,Mode:t})}))}))}},{key:"queueNext",value:function(e){this.queue(e,"QueueNext")}},{key:"nextItem",value:function(){this.manager.getApiClient().requestSyncPlayNextItem({PlaylistItemId:this.manager.getQueueCore().getCurrentPlaylistItemId()})}},{key:"previousItem",value:function(){this.manager.getApiClient().requestSyncPlayPreviousItem({PlaylistItemId:this.manager.getQueueCore().getCurrentPlaylistItemId()})}},{key:"setRepeatMode",value:function(e){this.manager.getApiClient().requestSyncPlaySetRepeatMode({Mode:e})}},{key:"setShuffleMode",value:function(e){this.manager.getApiClient().requestSyncPlaySetShuffleMode({Mode:e})}},{key:"toggleShuffleMode",value:function(){var e=this.manager.getQueueCore().getShuffleMode();e="Sorted"===e?"Shuffle":"Sorted",this.manager.getApiClient().requestSyncPlaySetShuffleMode({Mode:e})}}],a&&r(t.prototype,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.default=l},5839:function(e,t,a){a.r(t),a(2663),a(81414),a(84159),a(54112),a(48914),a(26031),a(95822),a(56187),a(38690),a(11908),a(33096),a(89228),a(13227),a(14011),a(11431);var n=a(7125),i=a(12718),r=a(75094),o=a(72963),l=a(60096),s=a(56663),u=a(94994),y=a(67561);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function p(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,h(n.key),n)}}function h(e){var t=function(e,t){if("object"!=c(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,"string");if("object"!=c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==c(t)?t:String(t)}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.playerFactory=t,this.apiClient=null,this.timeSyncCore=new i.default,this.playbackCore=new r.default,this.queueCore=new o.default,this.controller=new l.default,this.syncMethod="None",this.groupInfo=null,this.syncPlayEnabledAt=null,this.syncPlayReady=!1,this.queuedCommand=null,this.followingGroupPlayback=!0,this.lastPlaybackCommand=null,this.currentPlayer=null,this.playerWrapper=null}var t,a;return t=e,a=[{key:"init",value:function(e){var t=this;this.updateApiClient(e),this.playerWrapper=this.playerFactory.getDefaultWrapper(this),this.timeSyncCore.init(this),this.playbackCore.init(this),this.queueCore.init(this),this.controller.init(this),y.Z.on(this.timeSyncCore,"time-sync-server-update",(function(e,a,n){t.syncEnabled&&t.getApiClient().sendSyncPlayPing({Ping:n})}))}},{key:"updateApiClient",value:function(e){if(!e)throw new Error("ApiClient is null!");this.apiClient=e}},{key:"getTimeSyncCore",value:function(){return this.timeSyncCore}},{key:"getPlaybackCore",value:function(){return this.playbackCore}},{key:"getQueueCore",value:function(){return this.queueCore}},{key:"getController",value:function(){return this.controller}},{key:"getPlayerWrapper",value:function(){return this.playerWrapper}},{key:"getApiClient",value:function(){return this.apiClient}},{key:"getLastPlaybackCommand",value:function(){return this.lastPlaybackCommand}},{key:"onPlayerChange",value:function(e){this.bindToPlayer(e)}},{key:"bindToPlayer",value:function(e){this.releaseCurrentPlayer(),e&&(this.playerWrapper.unbindFromPlayer(),this.currentPlayer=e,this.playerWrapper=this.playerFactory.getWrapper(e,this),this.isSyncPlayEnabled()&&this.playerWrapper.bindToPlayer(),y.Z.trigger(this,"playerchange",[this.currentPlayer]))}},{key:"releaseCurrentPlayer",value:function(){this.currentPlayer=null,this.playerWrapper.unbindFromPlayer(),this.playerWrapper=this.playerFactory.getDefaultWrapper(this),this.isSyncPlayEnabled()&&this.playerWrapper.bindToPlayer(),y.Z.trigger(this,"playerchange",[this.currentPlayer])}},{key:"processGroupUpdate",value:function(e,t){switch(e.Type){case"PlayQueue":this.queueCore.updatePlayQueue(t,e.Data);break;case"UserJoined":(0,s.Z)(u.ZP.translate("MessageSyncPlayUserJoined",e.Data)),this.groupInfo.Participants?this.groupInfo.Participants.push(e.Data):this.groupInfo.Participants=[e.Data];break;case"UserLeft":(0,s.Z)(u.ZP.translate("MessageSyncPlayUserLeft",e.Data)),this.groupInfo.Participants&&(this.groupInfo.Participants=this.groupInfo.Participants.filter((function(t){return t!==e.Data})));break;case"GroupJoined":e.Data.LastUpdatedAt=new Date(e.Data.LastUpdatedAt),this.enableSyncPlay(t,e.Data,!0);break;case"SyncPlayIsDisabled":(0,s.Z)(u.ZP.translate("MessageSyncPlayIsDisabled"));break;case"NotInGroup":case"GroupLeft":this.disableSyncPlay(!0);break;case"GroupUpdate":e.Data.LastUpdatedAt=new Date(e.Data.LastUpdatedAt),this.groupInfo=e.Data;break;case"StateUpdate":y.Z.trigger(this,"group-state-update",[e.Data.State,e.Data.Reason]),console.debug("SyncPlay processGroupUpdate: state changed to ".concat(e.Data.State," because ").concat(e.Data.Reason,"."));break;case"GroupDoesNotExist":(0,s.Z)(u.ZP.translate("MessageSyncPlayGroupDoesNotExist"));break;case"CreateGroupDenied":(0,s.Z)(u.ZP.translate("MessageSyncPlayCreateGroupDenied"));break;case"JoinGroupDenied":(0,s.Z)(u.ZP.translate("MessageSyncPlayJoinGroupDenied"));break;case"LibraryAccessDenied":(0,s.Z)(u.ZP.translate("MessageSyncPlayLibraryAccessDenied"));break;default:console.error("SyncPlay processGroupUpdate: command ".concat(e.Type," not recognised."))}}},{key:"processCommand",value:function(e){if(null!==e)if("string"==typeof e.When&&(e.When=new Date(e.When),e.EmittedAt=new Date(e.EmittedAt),e.PositionTicks=e.PositionTicks?parseInt(e.PositionTicks,10):null),this.isSyncPlayEnabled())if(e.EmittedAt.getTime()<this.syncPlayEnabledAt.getTime())console.debug("SyncPlay processCommand: ignoring old command.",e);else{if(!this.syncPlayReady)return console.debug("SyncPlay processCommand: SyncPlay not ready, queued command.",e),void(this.queuedCommand=e);if(this.lastPlaybackCommand=e,this.isPlaybackActive()){var t=this.queueCore.getCurrentPlaylistItemId();e.PlaylistItemId===t||"Stop"===e.Command?(console.log("SyncPlay will ".concat(e.Command," at ").concat(e.When," (in ").concat(e.When.getTime()-Date.now()," ms)").concat(e.PositionTicks?"":" from "+e.PositionTicks,".")),this.playbackCore.applyCommand(e)):console.error("SyncPlay processCommand: playlist item does not match!",e)}else console.debug("SyncPlay processCommand: no active player!")}else console.debug("SyncPlay processCommand: SyncPlay not enabled, ignoring command.",e)}},{key:"processStateChange",value:function(e){null!==e&&null!==e.State&&null!==e.Reason&&(this.isSyncPlayEnabled()?y.Z.trigger(this,"group-state-change",[e.State,e.Reason]):console.debug("SyncPlay processStateChange: SyncPlay not enabled, ignoring group state update.",e))}},{key:"followGroupPlayback",value:function(e){return this.followingGroupPlayback=!0,e.requestSyncPlaySetIgnoreWait({IgnoreWait:!1})}},{key:"resumeGroupPlayback",value:function(e){var t=this;this.followGroupPlayback(e).then((function(){t.queueCore.startPlayback(e)}))}},{key:"haltGroupPlayback",value:function(e){this.followingGroupPlayback=!1,e.requestSyncPlaySetIgnoreWait({IgnoreWait:!0}),this.playbackCore.localStop()}},{key:"isFollowingGroupPlayback",value:function(){return this.followingGroupPlayback}},{key:"enableSyncPlay",value:function(e,t){var a=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.isSyncPlayEnabled()){if(t.GroupId===this.groupInfo.GroupId)return void console.debug("SyncPlay enableSyncPlay: group ".concat(this.groupInfo.GroupId," already joined."));console.warn("SyncPlay enableSyncPlay: switching from group ".concat(this.groupInfo.GroupId," to group ").concat(t.GroupId,".")),this.disableSyncPlay(!1),i=!1}this.groupInfo=t,this.syncPlayEnabledAt=t.LastUpdatedAt,this.playerWrapper.bindToPlayer(),y.Z.trigger(this,"enabled",[!0]),n.waitForEventOnce(this.timeSyncCore,"time-sync-server-update").then((function(){a.syncPlayReady=!0,a.processCommand(a.queuedCommand,e),a.queuedCommand=null})),this.syncPlayReady=!1,this.followingGroupPlayback=!0,this.timeSyncCore.forceUpdate(),i&&(0,s.Z)(u.ZP.translate("MessageSyncPlayEnabled"))}},{key:"disableSyncPlay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.syncPlayEnabledAt=null,this.syncPlayReady=!1,this.followingGroupPlayback=!0,this.lastPlaybackCommand=null,this.queuedCommand=null,this.playbackCore.syncEnabled=!1,y.Z.trigger(this,"enabled",[!1]),this.playerWrapper.unbindFromPlayer(),e&&(0,s.Z)(u.ZP.translate("MessageSyncPlayDisabled"))}},{key:"isSyncPlayEnabled",value:function(){return null!==this.syncPlayEnabledAt}},{key:"getGroupInfo",value:function(){return this.groupInfo}},{key:"getStats",value:function(){return{TimeSyncDevice:this.timeSyncCore.getActiveDeviceName(),TimeSyncOffset:this.timeSyncCore.getTimeOffset().toFixed(2),PlaybackDiff:this.playbackCore.playbackDiffMillis.toFixed(2),SyncMethod:this.syncMethod}}},{key:"isPlaybackActive",value:function(){return this.playerWrapper.isPlaybackActive()}},{key:"isRemote",value:function(){return this.playerWrapper.isRemote()}},{key:"isPlaylistEmpty",value:function(){return this.queueCore.isPlaylistEmpty()}},{key:"isPlaying",value:function(){return!!this.lastPlaybackCommand&&"Unpause"===this.lastPlaybackCommand.Command}},{key:"showSyncIcon",value:function(e){this.syncMethod=e,y.Z.trigger(this,"syncing",[!0,this.syncMethod])}},{key:"clearSyncIcon",value:function(){this.syncMethod="None",y.Z.trigger(this,"syncing",[!1,this.syncMethod])}}],a&&p(t.prototype,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.default=d}}]);