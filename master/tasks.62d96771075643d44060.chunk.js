"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[38919],{85041:function(e,n,t){t.r(n),t.d(n,{Component:function(){return _}});var r=t(62540),a=t(63696),o=t(65242),i=t(5898),l=t(5271),c=t(58765),u=t(15255),s=t(61586),f=t(69410),d="Tasks",y=function(e){var n=(0,f.gf)().api;return(0,s.I)({queryKey:[d],queryFn:function(t){var r=t.signal;return function(e,n,t){return r=void 0,a=void 0,i=function(){return function(e,n){var t,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=l(0),i.throw=l(1),i.return=l(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(c){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(o=0)),o;)try{if(t=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,r=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){o=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){o.label=l[1];break}if(6===l[0]&&o.label<a[1]){o.label=a[1],a=l;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(l);break}a[2]&&o.ops.pop(),o.trys.pop();continue}l=n.call(e,o)}catch(e){l=[6,e],r=0}finally{t=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}}(this,(function(r){switch(r.label){case 0:return e?[4,(0,u.g)(e).getTasks(n,t)]:(console.warn("[fetchTasks] No API instance available"),[2]);case 1:return[2,r.sent().data]}}))},new((o=void 0)||(o=Promise))((function(e,n){function t(e){try{c(i.next(e))}catch(e){n(e)}}function l(e){try{c(i.throw(e))}catch(e){n(e)}}function c(n){var r;n.done?e(n.value):(r=n.value,r instanceof o?r:new o((function(e){e(r)}))).then(t,l)}c((i=i.apply(r,a||[])).next())}));var r,a,o,i}(n,e,{signal:r})},enabled:!!n})};function h(e,n){return e?e.filter((function(e){return e.Category==n})).sort((function(e,n){var t;return e.Name&&n.Name?null===(t=e.Name)||void 0===t?void 0:t.localeCompare(n.Name):0})):[]}var v=t(84849),p=t(10041),x=t(99851),b=t(59616),m=t(1047),g=t(92294),A=t(65641),k=t(36173),j=t(82535),w=t(89100),S=t(67615),T=function(e){var n=e.task.CurrentProgressPercentage;return(0,r.jsx)(l.A,{sx:{display:"flex",alignItems:"center",height:"1.2rem",mr:2},children:null!=n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.A,{sx:{width:"100%",mr:1},children:(0,r.jsx)(S.A,{variant:"determinate",value:n})}),(0,r.jsx)(l.A,{children:(0,r.jsx)(x.A,{variant:"body1",children:"".concat(Math.round(n),"%")})})]}):(0,r.jsx)(l.A,{sx:{width:"100%"},children:(0,r.jsx)(S.A,{})})})},I=t(41906),C=t(34401),L=t(80096),E=t(28132),R=function(e){var n,t,o=e.task,l=(0,I.Y)().dateFnsLocale,c=function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,a,o=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(a)throw a.error}}return i}((0,a.useMemo)((function(){var e,n;if((null===(e=o.LastExecutionResult)||void 0===e?void 0:e.StartTimeUtc)&&(null===(n=o.LastExecutionResult)||void 0===n?void 0:n.EndTimeUtc)){var t=(0,C.A)(o.LastExecutionResult.EndTimeUtc),r=(0,C.A)(o.LastExecutionResult.StartTimeUtc);return[(0,L.A)(t,{locale:l,addSuffix:!0}),(0,E.A)(r,t,{locale:l})]}return[]}),[o,l]),2),u=c[0],s=c[1];if("Idle"!=o.State)return(0,r.jsx)(x.A,{sx:{color:"text.secondary"},children:i.Ay.translate("LabelStopping")});if((null===(n=o.LastExecutionResult)||void 0===n?void 0:n.StartTimeUtc)&&(null===(t=o.LastExecutionResult)||void 0===t?void 0:t.EndTimeUtc)){var f=o.LastExecutionResult.Status;return(0,r.jsxs)(x.A,{sx:{lineHeight:"1.2rem",color:"text.secondary"},variant:"body1",children:[i.Ay.translate("LabelScheduledTaskLastRan",u,s),"Failed"==f&&(0,r.jsx)(x.A,{display:"inline",color:"error",children:" (".concat(i.Ay.translate("LabelFailed"),")")}),"Cancelled"==f&&(0,r.jsx)(x.A,{display:"inline",color:"blue",children:" (".concat(i.Ay.translate("LabelCancelled"),")")}),"Aborted"==f&&(0,r.jsx)(x.A,{display:"inline",color:"error",children:" (".concat(i.Ay.translate("LabelAbortedByServerShutdown"),")")})]})}},q=t(34907),F=t(41566),N=t(53661),P=t(38596),M=t(53678),O=function(e){var n,t=e.task,o=(n=(0,f.gf)().api,(0,P.n)({mutationFn:function(e){return(0,u.g)(n).startTask(e)},onSuccess:function(){M.q.invalidateQueries({queryKey:[d]})}})),i=function(){var e=(0,f.gf)().api;return(0,P.n)({mutationFn:function(n){return(0,u.g)(e).stopTask(n)},onSuccess:function(){M.q.invalidateQueries({queryKey:[d]})}})}(),l=(0,a.useCallback)((function(){w.default.navigate("/dashboard/tasks/edit?id=".concat(t.Id)).catch((function(e){console.error("[Task] failed to navigate to task edit page",e)}))}),[t]),c=(0,a.useCallback)((function(){t.Id&&o.mutate({taskId:t.Id})}),[t,o]),s=(0,a.useCallback)((function(){t.Id&&i.mutate({taskId:t.Id})}),[t,i]);return(0,r.jsx)(b.Ay,{disablePadding:!0,secondaryAction:(0,r.jsx)(q.A,{onClick:"Running"==t.State?s:c,children:"Running"==t.State?(0,r.jsx)(N.A,{}):(0,r.jsx)(F.A,{})}),children:(0,r.jsxs)(A.A,{onClick:l,children:[(0,r.jsx)(k.A,{children:(0,r.jsx)(m.A,{sx:{bgcolor:"primary.main"},children:(0,r.jsx)(g.A,{sx:{color:"#fff"}})})}),(0,r.jsx)(j.A,{primary:(0,r.jsx)(x.A,{variant:"h3",children:t.Name}),secondary:"Running"==t.State?(0,r.jsx)(T,{task:t}):(0,r.jsx)(R,{task:t}),disableTypography:!0})]})})},Q=function(e){var n=e.category,t=e.tasks;return(0,r.jsxs)(c.A,{spacing:2,children:[(0,r.jsx)(x.A,{variant:"h2",children:n}),(0,r.jsx)(p.A,{sx:{bgcolor:"background.paper"},children:t.map((function(e){return(0,r.jsx)(O,{task:e},e.Id)}))})]})},U=t(10749),Y=t(10736),K=t(44797),_=function(){var e=(0,f.gf)().__legacyApiClient__,n=y({isHidden:!1}),t=n.data,u=n.isPending;if((0,a.useEffect)((function(){var n=function(e,n,t){M.q.setQueryData([d],t)},t=setInterval((function(){(null==e?void 0:e.isMessageChannelOpen())||M.q.invalidateQueries({queryKey:[d]})}),1e4);return null==e||e.sendMessage(U.Y.ScheduledTasksInfoStart,"1000,1000"),K.A.on(Y.default,U.Y.ScheduledTasksInfo,n),function(){clearInterval(t),null==e||e.sendMessage(U.Y.ScheduledTasksInfoStop,null),K.A.off(Y.default,U.Y.ScheduledTasksInfo,n)}}),[e]),u||!t)return(0,r.jsx)(v.A,{});var s=function(e){var n,t;if(!e)return[];var r=[];try{for(var a=function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),o=a.next();!o.done;o=a.next()){var i=o.value;i.Category&&!r.includes(i.Category)&&r.push(i.Category)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(n)throw n.error}}return r.sort((function(e,n){return e.localeCompare(n)}))}(t);return(0,r.jsx)(o.A,{id:"scheduledTasksPage",title:i.Ay.translate("TabScheduledTasks"),className:"mainAnimatedPage type-interior",children:(0,r.jsx)(l.A,{className:"content-primary",children:(0,r.jsx)(l.A,{className:"readOnlyContent",children:(0,r.jsx)(c.A,{spacing:3,mt:2,children:s.map((function(e){return(0,r.jsx)(Q,{category:e,tasks:h(t,e)},e)}))})})})})};_.displayName="TasksPage"},41906:function(e,n,t){t.d(n,{Y:function(){return f}});var r=t(62864),a=t(63696),o=t(5898),i=t(93721),l=t(28626),c=function(e,n,t,r){return new(t||(t=Promise))((function(a,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function l(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,l)}c((r=r.apply(e,n||[])).next())}))},u=function(e,n){var t,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=l(0),i.throw=l(1),i.return=l(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(c){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(o=0)),o;)try{if(t=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,r=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){o=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){o.label=l[1];break}if(6===l[0]&&o.label<a[1]){o.label=a[1],a=l;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(l);break}a[2]&&o.ops.pop(),o.trys.pop();continue}l=n.call(e,o)}catch(e){l=[6,e],r=0}finally{t=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}},s=function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,a,o=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(a)throw a.error}}return i};function f(){var e=this,n=(0,l.Q)(),t=n.dateTimeLocale,f=n.language,d=s((0,a.useState)(r.A),2),y=d[0],h=d[1],v=(0,a.useMemo)((function(){return(0,o.Tl)(f||(0,o.i5)())}),[f]),p=(0,a.useMemo)((function(){return t?(0,o.Tl)(t):v}),[t,v]);return(0,a.useEffect)((function(){c(e,void 0,void 0,(function(){var e,n;return u(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(0,i.Fq)((0,i.QC)(p))];case 1:return e=t.sent(),h(e),[3,3];case 2:return n=t.sent(),console.warn("[useLocale] failed to fetch dateFns locale",n),[3,3];case 3:return[2]}}))}))}),[p]),{locale:v,dateTimeLocale:p,dateFnsLocale:y}}}}]);