"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9601],{61427:function(e,t,a){a.r(t),a.d(t,{default:function(){return E}}),a(63238),a(61418),a(61013),a(48410),a(19068),a(87211),a(25901),a(92189),a(95163),a(52077),a(72482),a(69217),a(27471),a(32081),a(98010),a(99785),a(91047),a(5769),a(17460),a(14078);var n=a(67469),s=a(28978),i=a(53218),r=a(53754),o=a(47005);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function u(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,s=function(e,t){if("object"!==l(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t);if("object"!==l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key,"string"),"symbol"===l(s)?s:String(s)),n)}var s}var c,d,y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a;return t=e,(a=[{key:"load",value:function(){if("cordova"===window.appMode||"android"===window.appMode)return window.chrome=window.chrome||{},Promise.resolve();var e=!1;return e?Promise.resolve():new Promise((function(t){var a=document.createElement("script");a.setAttribute("type","text/javascript"),a.onload=function(){e=!0,t()},a.setAttribute("src","https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"),document.querySelector("head").appendChild(a)}))}}])&&u(t.prototype,a),Object.defineProperty(t,"prototype",{writable:!1}),e}(),m=a(53913),v=a(61642);function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,s=function(e,t){if("object"!==h(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t);if("object"!==h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key,"string"),"symbol"===h(s)?s:String(s)),n)}var s}function g(e,t,a){return t&&f(e.prototype,t),a&&f(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}var P="Google Cast";function S(e){var t=c,a=d;c=null,d=null,e?t&&t():a?a():i.O.removeActivePlayer(P)}var k="IDLE",I="urn:x-cast:com.connectsdk",b=function(){function e(){p(this,e),this.deviceState=0,this.currentMediaSession=null,this.session=null,this.castPlayerState=k,this.hasReceivers=!1,this.errorHandler=this.onError.bind(this),this.mediaStatusUpdateHandler=this.onMediaStatusUpdate.bind(this),this.initializeCastPlayer()}return g(e,[{key:"initializeCastPlayer",value:function(){var e=window.chrome;if(e)if(e.cast&&e.cast.isAvailable){var t="F007D354";"unstable"===s.chromecastVersion()&&(t="6F511C87");var a=new e.cast.SessionRequest(t),n=new e.cast.ApiConfig(a,this.sessionListener.bind(this),this.receiverListener.bind(this));console.debug("chromecast.initialize"),e.cast.initialize(n,this.onInitSuccess.bind(this),this.errorHandler)}else setTimeout(this.initializeCastPlayer.bind(this),1e3)}},{key:"onInitSuccess",value:function(){this.isInitialized=!0,console.debug("chromecast init success")}},{key:"onError",value:function(){console.debug("chromecast error")}},{key:"sessionListener",value:function(e){this.session=e,this.session&&(this.session.media[0]&&this.onMediaDiscovered("activeSession",this.session.media[0]),this.onSessionConnected(e))}},{key:"messageListener",value:function(e,t){if("string"==typeof t&&(t=JSON.parse(t)),"playbackerror"===t.type){var a=t.data;setTimeout((function(){M(r.ZP.translate("MessagePlaybackError"+a),r.ZP.translate("HeaderPlaybackError"))}),300)}else"connectionerror"===t.type?setTimeout((function(){M(r.ZP.translate("MessageChromecastConnectionError"),r.ZP.translate("HeaderError"))}),300):t.type&&o.Events.trigger(this,t.type,[t.data])}},{key:"receiverListener",value:function(e){"available"===e?(console.debug("chromecast receiver found"),this.hasReceivers=!0):(console.debug("chromecast receiver list empty"),this.hasReceivers=!1)}},{key:"sessionUpdateListener",value:function(e){e?console.debug("sessionUpdateListener: already alive"):(this.session=null,this.deviceState=0,this.castPlayerState=k,document.removeEventListener("volumeupbutton",C,!1),document.removeEventListener("volumedownbutton",T,!1),console.debug("sessionUpdateListener: setting currentMediaSession to null"),this.currentMediaSession=null,S(!1))}},{key:"launchApp",value:function(){console.debug("chromecast launching app..."),chrome.cast.requestSession(this.onRequestSessionSuccess.bind(this),this.onLaunchError.bind(this))}},{key:"onRequestSessionSuccess",value:function(e){console.debug("chromecast session success: "+e.sessionId),this.onSessionConnected(e)}},{key:"onSessionConnected",value:function(e){this.session=e,this.deviceState=1,this.session.addMessageListener(I,this.messageListener.bind(this)),this.session.addMediaListener(this.sessionMediaListener.bind(this)),this.session.addUpdateListener(this.sessionUpdateListener.bind(this)),document.addEventListener("volumeupbutton",C,!1),document.addEventListener("volumedownbutton",T,!1),o.Events.trigger(this,"connect"),this.sendMessage({options:{},command:"Identify"})}},{key:"sessionMediaListener",value:function(e){this.currentMediaSession=e,this.currentMediaSession.addUpdateListener(this.mediaStatusUpdateHandler)}},{key:"onLaunchError",value:function(){console.debug("chromecast launch error"),this.deviceState=3,S(!1)}},{key:"stopApp",value:function(){this.session&&this.session.stop(this.onStopAppSuccess.bind(this,"Session stopped"),this.errorHandler)}},{key:"onStopAppSuccess",value:function(e){console.debug(e),this.deviceState=0,this.castPlayerState=k,document.removeEventListener("volumeupbutton",C,!1),document.removeEventListener("volumedownbutton",T,!1),this.currentMediaSession=null}},{key:"loadMedia",value:function(e,t){return this.session?(e.items=e.items.map((function(e){return{Id:e.Id,ServerId:e.ServerId,Name:e.Name,Type:e.Type,MediaType:e.MediaType,IsFolder:e.IsFolder}})),this.sendMessage({options:e,command:t})):(console.debug("no session"),Promise.reject())}},{key:"sendMessage",value:function(e){var t,a=null,i=this.session;i&&i.receiver&&i.receiver.friendlyName&&(a=i.receiver.friendlyName),t=e.options&&e.options.ServerId?m.Z.getApiClient(e.options.ServerId):e.options&&e.options.items&&e.options.items.length?m.Z.getApiClient(e.options.items[0].ServerId):m.Z.currentApiClient(),e=Object.assign(e,{userId:t.getCurrentUserId(),deviceId:t.deviceId(),accessToken:t.accessToken(),serverAddress:t.serverAddress(),serverId:t.serverId(),serverVersion:t.serverVersion(),receiverName:a});var r=n.Z.maxChromecastBitrate();return r&&(e.maxBitrate=r),e.options&&e.options.items&&(e.subtitleAppearance=s.getSubtitleAppearanceSettings(),e.subtitleBurnIn=n.Z.get("subtitleburnin")||""),this.sendMessageInternal(e)}},{key:"sendMessageInternal",value:function(e){return e=JSON.stringify(e),this.session.sendMessage(I,e,this.onPlayCommandSuccess.bind(this),this.errorHandler),Promise.resolve()}},{key:"onPlayCommandSuccess",value:function(){console.debug("Message was sent to receiver ok.")}},{key:"onMediaDiscovered",value:function(e,t){console.debug("chromecast new media session ID:"+t.mediaSessionId+" ("+e+")"),this.currentMediaSession=t,"loadMedia"===e&&(this.castPlayerState="PLAYING"),"activeSession"===e&&(this.castPlayerState=t.playerState),this.currentMediaSession.addUpdateListener(this.mediaStatusUpdateHandler)}},{key:"onMediaStatusUpdate",value:function(e){console.debug("chromecast updating media: "+e),!1===e&&(this.castPlayerState=k)}},{key:"setReceiverVolume",value:function(e,t){this.currentMediaSession?e?this.session.setReceiverMuted(!0,this.mediaCommandSuccessCallback.bind(this),this.errorHandler):this.session.setReceiverVolumeLevel(t||1,this.mediaCommandSuccessCallback.bind(this),this.errorHandler):console.debug("this.currentMediaSession is null")}},{key:"mute",value:function(){this.setReceiverVolume(!0)}},{key:"mediaCommandSuccessCallback",value:function(e,t){console.debug(e)}}]),e}();function M(e,t){(0,v.Z)({text:e,title:t})}function C(){i.O.volumeUp()}function T(){i.O.volumeDown()}function w(e,t){o.Events.on(e._castPlayer,t,(function(a,n){console.debug("cc: "+t);var s=e.getPlayerStateInternal(n);o.Events.trigger(e,t,[s])}))}function L(){var e=this;e._castPlayer=new b,document.dispatchEvent(new CustomEvent("chromecastloaded",{detail:{player:e}})),o.Events.on(e._castPlayer,"connect",(function(t){c?S(!0):i.O.setActivePlayer(P,e.getCurrentTargetInfo()),console.debug("cc: connect"),e.lastPlayerData=null})),o.Events.on(e._castPlayer,"playbackstart",(function(t,a){console.debug("cc: playbackstart"),e._castPlayer.initializeCastPlayer();var n=e.getPlayerStateInternal(a);o.Events.trigger(e,"playbackstart",[n])})),o.Events.on(e._castPlayer,"playbackstop",(function(t,a){console.debug("cc: playbackstop");var n=e.getPlayerStateInternal(a);o.Events.trigger(e,"playbackstop",[n]);var s=(n=e.lastPlayerData.PlayState||{}).VolumeLevel||.5,i=n.IsMuted||!1;e.lastPlayerData={},e.lastPlayerData.PlayState={},e.lastPlayerData.PlayState.VolumeLevel=s,e.lastPlayerData.PlayState.IsMuted=i})),o.Events.on(e._castPlayer,"playbackprogress",(function(t,a){console.debug("cc: positionchange");var n=e.getPlayerStateInternal(a);o.Events.trigger(e,"timeupdate",[n])})),w(e,"timeupdate"),w(e,"pause"),w(e,"unpause"),w(e,"volumechange"),w(e,"repeatmodechange"),w(e,"shufflequeuemodechange"),o.Events.on(e._castPlayer,"playstatechange",(function(t,a){console.debug("cc: playstatechange");var n=e.getPlayerStateInternal(a);o.Events.trigger(e,"pause",[n])}))}var E=function(){function e(){p(this,e),this.name=P,this.type="mediaplayer",this.id="chromecast",this.isLocalPlayer=!1,this.lastPlayerData={},(new y).load().then(L.bind(this))}return g(e,[{key:"tryPair",value:function(e){var t=this._castPlayer;return 1!==t.deviceState&&t.isInitialized?new Promise((function(e,a){c=e,d=a,t.launchApp()})):(c=null,d=null,Promise.reject())}},{key:"getTargets",value:function(){var e=[];return this._castPlayer&&this._castPlayer.hasReceivers&&e.push(this.getCurrentTargetInfo()),Promise.resolve(e)}},{key:"getCurrentTargetInfo",value:function(){var e=null,t=this._castPlayer;return t.session&&t.session.receiver&&t.session.receiver.friendlyName&&(e=t.session.receiver.friendlyName),{name:P,id:P,playerName:P,playableMediaTypes:["Audio","Video"],isLocalPlayer:!1,appName:P,deviceName:e,supportedCommands:["VolumeUp","VolumeDown","Mute","Unmute","ToggleMute","SetVolume","SetAudioStreamIndex","SetSubtitleStreamIndex","DisplayContent","SetRepeatMode","SetShuffleQueue","EndSession","PlayMediaSource","PlayTrailers"]}}},{key:"getPlayerStateInternal",value:function(e){var t=!1;return e&&!this.lastPlayerData&&(t=!0),e=e||this.lastPlayerData,this.lastPlayerData=e,function(e){if(e&&e.NowPlayingItem){var t=e.NowPlayingItem;t.ImageTags&&t.ImageTags.Primary||t.PrimaryImageTag&&(t.ImageTags=t.ImageTags||{},t.ImageTags.Primary=t.PrimaryImageTag),t.BackdropImageTag&&t.BackdropItemId===t.Id&&(t.BackdropImageTags=[t.BackdropImageTag]),t.BackdropImageTag&&t.BackdropItemId!==t.Id&&(t.ParentBackdropImageTags=[t.BackdropImageTag],t.ParentBackdropItemId=t.BackdropItemId)}}(e),console.debug(JSON.stringify(e)),t&&o.Events.trigger(this,"statechange",[e]),e}},{key:"playWithCommand",value:function(e,t){if(!e.items){var a=m.Z.getApiClient(e.serverId),n=this;return a.getItem(a.getCurrentUserId(),e.ids[0]).then((function(a){return e.items=[a],n.playWithCommand(e,t)}))}return e.items.length>1&&e&&e.ids&&e.items.sort((function(t,a){return e.ids.indexOf(t.Id)-e.ids.indexOf(a.Id)})),this._castPlayer.loadMedia(e,t)}},{key:"seek",value:function(e){e=parseInt(e),e/=1e7,this._castPlayer.sendMessage({options:{position:e},command:"Seek"})}},{key:"setAudioStreamIndex",value:function(e){this._castPlayer.sendMessage({options:{index:e},command:"SetAudioStreamIndex"})}},{key:"setSubtitleStreamIndex",value:function(e){this._castPlayer.sendMessage({options:{index:e},command:"SetSubtitleStreamIndex"})}},{key:"setMaxStreamingBitrate",value:function(e){this._castPlayer.sendMessage({options:e,command:"SetMaxStreamingBitrate"})}},{key:"isFullscreen",value:function(){var e=this.lastPlayerData||{};return(e=e.PlayState||{}).IsFullscreen}},{key:"nextTrack",value:function(){this._castPlayer.sendMessage({options:{},command:"NextTrack"})}},{key:"previousTrack",value:function(){this._castPlayer.sendMessage({options:{},command:"PreviousTrack"})}},{key:"volumeDown",value:function(){var e=this._castPlayer.session.receiver.volume.level;null==e&&(e=.5),e-=.05,e=Math.max(e,0),this._castPlayer.session.setReceiverVolumeLevel(e)}},{key:"endSession",value:function(){var e=this;this.stop().then((function(){setTimeout((function(){e._castPlayer.stopApp()}),1e3)}))}},{key:"volumeUp",value:function(){var e=this._castPlayer.session.receiver.volume.level;null==e&&(e=.5),e+=.05,e=Math.min(e,1),this._castPlayer.session.setReceiverVolumeLevel(e)}},{key:"setVolume",value:function(e){e=Math.min(e,100),e=Math.max(e,0),e/=100,this._castPlayer.session.setReceiverVolumeLevel(e)}},{key:"unpause",value:function(){this._castPlayer.sendMessage({options:{},command:"Unpause"})}},{key:"playPause",value:function(){this._castPlayer.sendMessage({options:{},command:"PlayPause"})}},{key:"pause",value:function(){this._castPlayer.sendMessage({options:{},command:"Pause"})}},{key:"stop",value:function(){return this._castPlayer.sendMessage({options:{},command:"Stop"})}},{key:"displayContent",value:function(e){this._castPlayer.sendMessage({options:e,command:"DisplayContent"})}},{key:"setMute",value:function(e){var t=this._castPlayer;e?t.sendMessage({options:{},command:"Mute"}):t.sendMessage({options:{},command:"Unmute"})}},{key:"getRepeatMode",value:function(){var e=this.lastPlayerData||{};return(e=e.PlayState||{}).RepeatMode}},{key:"getQueueShuffleMode",value:function(){var e=this.lastPlayerData||{};return(e=e.PlayState||{}).ShuffleMode}},{key:"playTrailers",value:function(e){this._castPlayer.sendMessage({options:{ItemId:e.Id,ServerId:e.ServerId},command:"PlayTrailers"})}},{key:"setRepeatMode",value:function(e){this._castPlayer.sendMessage({options:{RepeatMode:e},command:"SetRepeatMode"})}},{key:"setQueueShuffleMode",value:function(e){this._castPlayer.sendMessage({options:{ShuffleMode:e},command:"SetShuffleQueue"})}},{key:"toggleMute",value:function(){this._castPlayer.sendMessage({options:{},command:"ToggleMute"})}},{key:"audioTracks",value:function(){var e=this.lastPlayerData||{};return((e=e.NowPlayingItem||{}).MediaStreams||[]).filter((function(e){return"Audio"===e.Type}))}},{key:"getAudioStreamIndex",value:function(){var e=this.lastPlayerData||{};return(e=e.PlayState||{}).AudioStreamIndex}},{key:"subtitleTracks",value:function(){var e=this.lastPlayerData||{};return((e=e.NowPlayingItem||{}).MediaStreams||[]).filter((function(e){return"Subtitle"===e.Type}))}},{key:"getSubtitleStreamIndex",value:function(){var e=this.lastPlayerData||{};return(e=e.PlayState||{}).SubtitleStreamIndex}},{key:"getMaxStreamingBitrate",value:function(){var e=this.lastPlayerData||{};return(e=e.PlayState||{}).MaxStreamingBitrate}},{key:"getVolume",value:function(){var e=this.lastPlayerData||{};return null==(e=e.PlayState||{}).VolumeLevel?100:e.VolumeLevel}},{key:"isPlaying",value:function(e){var t=this.lastPlayerData||{};return null!=t.NowPlayingItem&&(t.NowPlayingItem.MediaType===e||!e)}},{key:"isPlayingVideo",value:function(){var e=this.lastPlayerData||{};return"Video"===(e=e.NowPlayingItem||{}).MediaType}},{key:"isPlayingAudio",value:function(){var e=this.lastPlayerData||{};return"Audio"===(e=e.NowPlayingItem||{}).MediaType}},{key:"currentTime",value:function(e){if(null!=e)return this.seek(1e4*e);var t=this.lastPlayerData||{};return(t=t.PlayState||{}).PositionTicks/1e4}},{key:"duration",value:function(){var e=this.lastPlayerData||{};return(e=e.NowPlayingItem||{}).RunTimeTicks}},{key:"getBufferedRanges",value:function(){var e=this.lastPlayerData||{};return(e=e.PlayState||{}).BufferedRanges||[]}},{key:"paused",value:function(){var e=this.lastPlayerData||{};return(e=e.PlayState||{}).IsPaused}},{key:"isMuted",value:function(){var e=this.lastPlayerData||{};return(e=e.PlayState||{}).IsMuted}},{key:"shuffle",value:function(e){var t=m.Z.getApiClient(e.ServerId),a=t.getCurrentUserId(),n=this;t.getItem(a,e.Id).then((function(e){n.playWithCommand({items:[e]},"Shuffle")}))}},{key:"instantMix",value:function(e){var t=m.Z.getApiClient(e.ServerId),a=t.getCurrentUserId(),n=this;t.getItem(a,e.Id).then((function(e){n.playWithCommand({items:[e]},"InstantMix")}))}},{key:"canPlayMediaType",value:function(e){return"audio"===(e=(e||"").toLowerCase())||"video"===e}},{key:"canQueueMediaType",value:function(e){return this.canPlayMediaType(e)}},{key:"queue",value:function(e){this.playWithCommand(e,"PlayLast")}},{key:"queueNext",value:function(e){this.playWithCommand(e,"PlayNext")}},{key:"play",value:function(e){if(e.items)return this.playWithCommand(e,"PlayNow");if(!e.serverId)throw new Error("serverId required!");var t,a,n,s=this;return(t=m.Z.getApiClient(e.serverId),a={Ids:e.ids.join(",")},n=t.getCurrentUserId(),a.Ids&&1===a.Ids.split(",").length?t.getItem(n,a.Ids.split(",")).then((function(e){return{Items:[e],TotalRecordCount:1}})):(a.Limit=a.Limit||100,a.ExcludeLocationTypes="Virtual",a.EnableTotalRecordCount=!1,t.getItems(n,a))).then((function(t){return e.items=t.Items,s.playWithCommand(e,"PlayNow")}))}},{key:"toggleFullscreen",value:function(){}},{key:"beginPlayerUpdates",value:function(){}},{key:"endPlayerUpdates",value:function(){}},{key:"getPlaylist",value:function(){return Promise.resolve([])}},{key:"getCurrentPlaylistItemId",value:function(){}},{key:"setCurrentPlaylistItem",value:function(e){return Promise.resolve()}},{key:"removeFromPlaylist",value:function(e){return Promise.resolve()}},{key:"getPlayerState",value:function(){return this.getPlayerStateInternal()||{}}}]),e}()}}]);